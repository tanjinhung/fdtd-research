# Note: The dependence on the header files is generated by
#       makedepend.  Prior to making, issue the command:
#
#               make depend
#
##########################################################
FLAGS=-Wall -O

MAINSRC1=improved1.c
OFILES1=${MAINSRC1:.c=.o}
EXE1=${MAINSRC1:.c=}

MAINSRC2=improved2.c
SRC2=${MAINSRC2} ezinc2.c gridinit2.c update2.c
OFILES2=${SRC2:.c=.o}
EXE2=${MAINSRC2:.c=}

MAINSRC3=improved3.c 
SRC3=${MAINSRC3} abc.c ezinc3.c gridinit3.c snapshot.c tfsf.c update3.c
OFILES3=${SRC3:.c=.o}
EXE3=${MAINSRC3:.c=}

all: ${EXE1} ${EXE2} ${EXE3} struct-demo1 struct-demo2 param-demo1

${EXE1}: ${OFILES1}
	gcc ${FLAGS} ${OFILES1} -lm -o $@

${EXE2}: ${OFILES2}
	gcc ${FLAGS} ${OFILES2} -lm -o $@

${EXE3}: ${OFILES3}
	gcc ${FLAGS} ${OFILES3} -lm -o $@

struct-demo1: struct-demo1.c
	gcc ${FLAGS} struct-demo1.c -o struct-demo1

struct-demo2: struct-demo2.c
	gcc ${FLAGS} struct-demo2.c -o struct-demo2

param-demo1: param-demo1.c harmonic-demo1.c
	gcc ${FLAGS} param-demo1.c harmonic-demo1.c -o param-demo1

# A way to obtain unique file names -- not truly necessary, but
# prevents some duplication in the depends.  Found the perl script on
# the Web.  No way I would generate this on my own.  Note that the
# double dollar signs are reduced to single dollar signs before perl
# sees the script.
UNIQSRC=$(shell echo ${SRC1} ${SRC2} ${SRC3} |\
       perl -e 'while(<>) {               \
          %s=();                          \
          @u=grep {! $$s{$$_} ++ } sort(split()); \
          print "@u";}')

#================================================

.SUFFIXES: .c .o

.c.o:
	gcc -c -O -Wall $<

clean:
	rm -f *~ sim.? sim.?? junk*
	rm -f ${OFILES1} ${OFILES2} ${OFILES3}
	rm -f ${EXE1} ${EXE2} ${EXE3}
	rm -f struct-demo1 struct-demo2
	rm -f param-demo1 param-demo2

# -Y to prevent search of system headers and
# pipe warning to /dev/null since it will complain
# about not finding the system headers!
depend:
	makedepend -Y ${UNIQSRC} &> /dev/null

# DO NOT DELETE

abc.o: fdtd3.h
ezinc.o: ezinc.h fdtd2.h
gridinit2.o: fdtd2.h
gridinit3.o: fdtd3.h
improved2.o: fdtd2.h ezinc.h
improved3.o: fdtd3.h
snapshot.o: fdtd3.h
tfsf.o: fdtd3.h ezinc.h fdtd2.h
update2.o: fdtd2.h
update3.o: fdtd3.h
